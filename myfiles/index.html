{{/*
  精选+网格布局首页模板
  文件位置: layouts/index.html
  
  功能:
  - 顶部精选区: 1大+3小
  - 下方网格: 3列卡片
  - 响应式设计
*/}}

{{- define "main" }}

<div class="home-container">
  
  {{/* ===== 首页头部信息 ===== */}}
  {{- with .Site.Params.homeInfoParams }}
  <div class="home-info-header">
    <h1>{{ .Title | markdownify }}</h1>
    <p>{{ .Content | markdownify }}</p>
    
    {{/* 社交图标 */}}
    {{- if $.Site.Params.socialIcons }}
    <div class="social-icons">
      {{- range $.Site.Params.socialIcons }}
      <a href="{{ .url }}" target="_blank" rel="noopener" title="{{ .title | default .name }}">
        {{- partial "svg.html" . -}}
      </a>
      {{- end }}
    </div>
    {{- end }}
  </div>
  {{- end }}

  {{/* ===== 精选文章区 ===== */}}
  {{- $pages := where .Site.RegularPages "Type" "posts" }}
  {{- $featured := first 4 $pages }}
  
  {{- if ge (len $featured) 1 }}
  <section class="featured-section">
    <div class="featured-grid">
      
      {{/* 主推文章 - 第1篇 */}}
      {{- with index $featured 0 }}
      <article class="featured-main">
        <a href="{{ .Permalink }}">
          {{- $cover := .Params.cover.image }}
          {{- if $cover }}
          <div class="featured-image">
            <img src="{{ $cover }}" alt="{{ .Title }}" loading="lazy">
          </div>
          {{- else }}
          <div class="featured-image placeholder">
            <span>{{ .Title | truncate 20 }}</span>
          </div>
          {{- end }}
          
          <div class="featured-content">
            {{- with .Params.tags }}
            <span class="tag">{{ index . 0 }}</span>
            {{- end }}
            <h2>{{ .Title }}</h2>
            <p>{{ .Summary | truncate 150 }}</p>
            <div class="post-meta">
              {{- partial "post_meta.html" . -}}
            </div>
          </div>
        </a>
      </article>
      {{- end }}
      
      {{/* 侧边文章 - 第2-4篇 */}}
      <div class="featured-side">
        {{- range $index, $page := after 1 (first 4 $featured) }}
        <article class="featured-side-card">
          <a href="{{ .Permalink }}">
            {{- $cover := .Params.cover.image }}
            <div class="card-image-wrapper">
              {{- if $cover }}
              <img src="{{ $cover }}" alt="{{ .Title }}" loading="lazy">
              {{- else }}
              <div class="thumb-placeholder">{{ .Title | truncate 15 }}</div>
              {{- end }}
            </div>
            
            <div class="card-content">
              {{- with .Params.tags }}
              {{- if ge (len .) 2 }}
              <span class="tag">{{ index . 1 }}</span>
              {{- else }}
              <span class="tag">{{ index . 0 }}</span>
              {{- end }}
              {{- end }}
              <h3>{{ .Title | truncate 60 }}</h3>
              <div class="post-meta">
                <span>{{ .ReadingTime }} 分钟阅读</span>
              </div>
            </div>
          </a>
        </article>
        {{- end }}
      </div>
      
    </div>
  </section>
  {{- end }}

  {{/* ===== 最新文章网格 ===== */}}
  {{- $restPages := after 4 $pages }}
  {{- if $restPages }}
  <section class="posts-section">
    <h2 class="section-title">
      <span class="title-bar"></span>
      最新文章
    </h2>
    
    <div class="posts-grid">
      {{- range first 6 $restPages }}
      <article class="post-card">
        <a href="{{ .Permalink }}">
          {{- $cover := .Params.cover.image }}
          {{- if $cover }}
          <div class="card-image">
            <img src="{{ $cover }}" alt="{{ .Title }}" loading="lazy">
          </div>
          {{- else }}
          <div class="card-image placeholder">
            <span>{{ substr .Title 0 10 }}</span>
          </div>
          {{- end }}
          
          <div class="card-body">
            {{- with .Params.tags }}
            <span class="tag">{{ index . 0 }}</span>
            {{- end }}
            <h3>{{ .Title | truncate 45 }}</h3>
            <div class="post-meta">
              <time>{{ .Date.Format "2006-01-02" }}</time>
              <span>·</span>
              <span>{{ .ReadingTime }} 分钟</span>
            </div>
          </div>
        </a>
      </article>
      {{- end }}
    </div>
    
    {{/* 查看更多按钮 */}}
    {{- if gt (len $restPages) 9 }}
    <div class="view-more">
      <a href="{{ "posts/" | relURL }}" class="btn-more">
        查看全部文章 →
      </a>
    </div>
    {{- end }}
    
  </section>
  {{- end }}

</div>

{{- end }}{{/* end main */}}